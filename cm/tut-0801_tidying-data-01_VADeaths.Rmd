---
output: github_document
bibliography: "../manage/refs.bib" 
csl: "../manage/csl/journal-of-peace-research.csl"
---

```{r echo=FALSE}
library(knitr)
opts_knit$set(root.dir = "../")
opts_chunk$set(echo = TRUE, message = FALSE, collapse = TRUE, warning = FALSE, cache = TRUE, cache.path = "tut-08-cache/01-", fig.path = "tut-08-images/01-")
```


## tidying data

Preparation 

- Start a new script in your *practiceR* directory called *tut06_tidying-data-01_VADeaths.R*  
- Start with your usual header  
  
        #  ---------------------------------------  
        #  tidying data
        #  VADeaths: 1940 death rates in Virginia
        #  
        #  name  
        #  date  
        #  ---------------------------------------  

- Remember to install any packages you haven't used before  
  
```{r}
# housekeeping
rm(list = ls())

# packages
library(plyr)     # for round_any
library(dplyr)    # for %>%, select(), mutate(), filter()
library(tibble)   # rownames_to_column()
library(tidyr)    # for gather(), spread()
library(stringr)  # for str_split_fixed()
library(ggplot2)  # for graphs
library(readr)    # for read_csv()
```

Whenever you want to use both *plyr* and *dplyr* packages, make sure you load *plyr* first. (And then do not load *plyr* again in the same session.)


## first look 

We'll revisit the *VADeaths* dataset, part of the base R installation. 
  
```{r}
# load the data
data(VADeaths)

# what nature of R object is it? 
class(VADeaths)

# print it
print(VADeaths)
```

The data are in a matrix (not a data frame) and it looks like the age groups are in the row names. To check, use *row.names()*. 

```{r}
row.names(VADeaths)
```



## matrix to data frame

Convert the matrix to a data frame. 

```{r}
VA_wide <- data.frame(VADeaths)
kable(VA_wide)
```

First, let's copy the age group variable from the row names to a new variable column in the data frame. 

```{r}
VA_wide <- VA_wide %>% 
	rownames_to_column("age_group")

# result
kable(VA_wide)

print(VA_wide)
```

Note that after using *rownames_to_column()* the row names are now the usual consecutive integers. 






## gather()

We see that two categories are aggregated in the column names

- location: rural or urban 
- sex: male or female

```{r}
VA_wide %>% 
	gather(location_sex
				 , death_rate
				 , Rural.Male:Urban.Female
				 ) -> VA_long1






# result
print(VA_long1)

kable(VA_long1)

# examine
glimpse(VA_long1)
```

## separate the location.sex variable  

Two variables are recorded in the same column: location and sex. 

This is a string variable so we can split the column into two columns using the *tidyr::separate()* 

```{r}
VA_long2 <- separate(VA_long1, location_sex, into = c("location", "sex"))

# result
glimpse(VA_long2)
```

Awesome! The dataset is tidy. Let's rearrange the order of the columns with *select()* and the order of rows with *arrange()*.

```{r}
# rearrange the order of columns and rows
VA_long2 <- VA_long2 %>% 
	select(sex, location, age_group, death_rate) %>% 
	arrange(sex, location, age_group) 
```

Print out to confirm. 

```{r}
kable(VA_long2)
```

On to the next data tidying tutorial using the World Health Organization (WHO) 2016 tuberculosis data set. 
