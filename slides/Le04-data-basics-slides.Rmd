---
title: "**Data basics**"
author: "Richard Layton"
date: "2017-09-05"
output: beamer_presentation
---

```{r setup, include=FALSE}
library(knitr)
opts_knit$set(root.dir = "../")
opts_chunk$set(echo=TRUE, message=FALSE, collapse=FALSE)
opts_chunk$set(fig.height = 5.5)
options(width = 52)
```

```{r include=FALSE}
library(tidyverse)
library(readxl)
library(pander)
panderOptions('table.alignment.default', function(df)
    ifelse(sapply(df, is.numeric), 'right', 'left'))
panderOptions('table.split.table', Inf)
panderOptions('big.mark', ",")
panderOptions('keep.trailing.zeros', TRUE)
```

## R packages used in data basics

```{r echo=FALSE}
df <- tribble(
	~Package, ~For,
	"tidyverse", "ggplot2, dplyr, readr, tidyr", 
	"ggplot2",   "Graphing data", 
	"dplyr",     "Data manipulation", 
	"readr",     "Read rectangular data files (like csv or tsv)", 
	"tidyr",     "Set of functions that help you get to tidy data",     "knitr",     "Dynamic documents", 
	"readxl",    "Read .xls and .xslx files",
	"VIM",       "Examine missing values in a data frame"
)
```

```{r echo=FALSE}
pander(df, split.cells = c(30, 60))
```

## At the conclusion of the tutorial, you will be able to 

- Define a "tidy" dataset  
- Read data from an Excel file 
- Obtain datasets included with R and R packages 
- Read and write CSV data files 

\begin{center}
\includegraphics[scale=0.3]{../images/data-basics-excel-to-csv.png}
\end{center}




## For data graphics success, data should be tidy

\vspace{0.5\baselineskip}
\begin{center}
\includegraphics[scale=0.6]{../images/data-basics-tidy-schematic.png}
\end{center}

\vspace{5\baselineskip}
{\footnotesize
Source: data-wrangling-cheatsheet,  https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf
}


## Tidy data

\vspace{1\baselineskip}
\begin{center}
\includegraphics[scale=0.4]{../images/tidy-4a.png}
\end{center}

\vspace{1\baselineskip}
{\footnotesize
Source: Data Science with R by Garrett Grolemund,   http://garrettgman.github.io/tidying/
}



## Sadly, untidy data is common

\vspace{0.5\baselineskip}
\begin{center}
\includegraphics[scale=0.4]{../images/tidy-5a.png}
\end{center}

\vspace{1\baselineskip}
{\footnotesize
Source: Data Science with R by Garrett Grolemund,   http://garrettgman.github.io/tidying/
}

## Sadly, untidy data is common

\vspace{0.5\baselineskip}
\begin{center}
\includegraphics[scale=0.4]{../images/tidy-7a.png}
\end{center}

\vspace{-1\baselineskip}
{\footnotesize
Source: Data Science with R by Garrett Grolemund,   http://garrettgman.github.io/tidying/
}

## Some industry spreadsheets are really untidy

\includegraphics[scale=0.5]{../images/data-basics-very-untidy-data.png}

\vspace{-0.5\baselineskip}
{\footnotesize
Source: Extract tables from messy spreadsheets with jailbreakr, http://blog.revolutionanalytics.com/2016/08/jailbreakr.html
}



## For now, assume your data in Excel are tidy

\includegraphics[scale=0.55]{../images/data-basics-excel-long.png}

\vspace{1\baselineskip}

- *readxl* is the package
- *read_excel()* is the function


## The data frame that results from  *read_excel()*

```{r}
library(readxl)
tidy_data <- read_excel(
       path = "data/DSR-table1.xlsx"
    , sheet = "DSR-table1"
    )
glimpse(tidy_data)
```

## Or, if we print the data frame as a table

```{r}
library(knitr)
kable(tidy_data)
```


## Note the relative path argument in *read_excel()*

\begin{center}
\includegraphics[scale=0.4]{../images/data-basics-relative-path.png}
\end{center}


## But, when your Excel data are not tidy

\begin{center}
\includegraphics[scale=0.55]{../images/data-basics-excel-not-tidy.png}
\end{center}

## The *read_excel()* results can be weird


```{r}
untidy_data <- read_excel("data/VADeaths.xlsx")
glimpse(untidy_data)
```

- All the data have been coerced into character data

## Or, if we print the result as a table

```{r}
kable(untidy_data)
```

- The first data row is not actually an observation 



## However,  *read_excel()* can skip lines 

\begin{center}
\includegraphics[scale=0.55]{../images/data-basics-excel-not-tidy.png}
\end{center}

```{r }
untidy_data <- read_excel("data/VADeaths.xlsx"
	, skip = 1)
```


## But we might lose information 

```{r}
kable(untidy_data)
```

- Try to work with tidy data only for the time being  
- Later we will work on how to make untidy data tidy
 
 
 
 
## Read and write CSV files

If you have a data frame *tidy_data* in your workspace

```{r}
library(readr)
write_csv(tidy_data, "data/example_tidy_data.csv")
```

If you have file *example_tidy_data.csv* in your *data* folder 
```{r}
new_copy <- read_csv("data/example_tidy_data.csv")
```




## Examine a data frame

Graphing data and studying the data structure are complementary

- *class()*
- *glimpse()*
- *kable()*  
- *head()*
- *tail()*

Identifying missing values (details in the tutorial)

- *summary()* 
- *VIM* package *aggr()* function 





##  Accessing data in R

```{r eval=FALSE}
data()
```

```
Data sets in package 'datasets':

AirPassengers  Monthly Airline Passenger Numbers 1949-1960
BJsales        Sales Data with Leading Indicator
BOD            Biochemical Oxygen Demand
CO2            Carbon Dioxide Uptake in Grass Plants
ChickWeight    Weight vs age of chicks on different diets
etc. 
```

##  Many of these R data sets widely used in R examples 

Commonly encountered 

- `mtcars`
- `iris`
- `Titanic`
- `barley` in the *lattice* package

From the tidyverse

- `starwars` in the *dplyr* package
- `economics` in the *ggplot2* package 
- `who` in the *tidyr* package 

And other packages

- *fivethirtyeight* package 
- so many more 


## Review

\begin{columns}[T]

\begin{column}[T]{0.5\textwidth}

package::function()

\begin{itemize}
\item readxl::read\_excel()
\item readr::write\_csv()
\item readr::read\_csv()
\item tibble::glimpse()
\item knitr::kable()
\item VIM::aggr()
\end{itemize}

\end{column}
\begin{column}[T]{0.5\textwidth}

base R functions

\begin{itemize}
\item data()
\item class()
\item head()
\item tail()
\item summary()
\item unloadNamespace()
\item search()
\end{itemize}

\end{column}
\end{columns}

ggplot2

\begin{itemize}
\item geom\_smooth(method = lm, se = FALSE)
\end{itemize}
